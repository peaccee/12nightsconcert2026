<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>胡志龍的十二夜 - 票券預訂</title>
    <style>
        body { font-family: "Microsoft JhengHei", sans-serif; background-color: #f4f4f4; padding: 20px; color: #333; }
        .container { max-width: 800px; margin: auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #2c3e50; font-size: 1.8em; margin-bottom: 10px; margin-top: 20px; }
        h2 { background: #f8f9fa; padding: 12px; border-left: 6px solid #b38b5d; font-size: 1.1em; margin-top: 30px; border-radius: 0 4px 4px 0; }
        
        .discount-tag { text-align: center; color: #d35400; font-weight: bold; background: #fff5eb; padding: 10px; border-radius: 8px; margin-bottom: 20px; border: 1px dashed #d35400; }
        
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input[type="text"], input[type="email"], input[type="tel"], select, textarea { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 6px; box-sizing: border-box; font-size: 16px; background-color: white; }
        
        table { width: 100%; border-collapse: collapse; margin: 15px 0; background: #fff; }
        td { padding: 12px; border-bottom: 1px solid #eee; }
        
        /* 統一場次標題樣式 */
        .venue-name { font-weight: bold; color: #b38b5d; background: #fdfdfd; border-top: 2px solid #eee; }
        
        /* 僅針對自由入場說明文字變灰 */
        .free-entry-label { color: #999; font-weight: normal; font-size: 0.95em; }

        .note-text { font-size: 0.85em; color: #7f8c8d; margin-top: 4px; display: block; line-height: 1.4; }

        .summary-box { background: #2c3e50; color: white; padding: 25px; border-radius: 10px; margin-top: 30px; }
        .summary-line { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 1.1em; }
        .total-amount { font-size: 1.6em; color: #f1c40f; border-top: 1px solid #5e6d7d; padding-top: 15px; margin-top: 10px; font-weight: bold; }
        
        .bank-info { background: #fdf9e7; padding: 20px; border-radius: 8px; border: 1px solid #e6dbac; margin-top: 15px; }
        .submit-btn { width: 100%; padding: 18px; background: #b38b5d; color: white; border: none; border-radius: 8px; font-size: 1.3em; cursor: pointer; margin-top: 25px; font-weight: bold; transition: 0.3s; }
        .submit-btn:hover { background: #96724a; }
        
        .footer { text-align: center; margin-top: 40px; font-size: 0.9em; color: #7f8c8d; line-height: 1.8; border-top: 1px solid #eee; padding-top: 20px; }

        #success-message { display: none; text-align: center; padding: 50px 20px; }
        #success-message h3 { color: #2c3e50; font-size: 1.5em; margin-bottom: 20px; }
    </style>
</head>
<body>

<div class="container" id="form-container">
    <h1>胡志龍 2026 鋼琴獨奏會 - 胡志龍的十二夜</h1>
    
    <div class="discount-tag">
        團體購票優惠：3張8折｜4張75折｜5張以上7折 (跨售票場次累計)
    </div>

    <form id="ticketForm" action="https://formspree.io/f/xeeeoknw" method="POST">
        
        <h2>購票者資訊</h2>
        <div class="form-group">
            <label>購票者姓名 *</label>
            <input type="text" name="購票者姓名" required>
        </div>
        <div class="form-group">
            <label>電子信箱 Email *</label>
            <input type="email" name="Email" required>
        </div>
        <div class="form-group">
            <label>聯絡電話 * (10碼數字)</label>
            <input type="tel" name="聯絡電話" required pattern="[0-9]{10}" title="請輸入10碼數字">
        </div>

        <h2>選擇訂購場次與張數</h2>
        <table>
            <tbody>
                <tr class="venue-name"><td colspan="2">一、巴赫 Bach 3/11 (三) 19:00 臺北和平基督長老教會</td></tr>
                <tr><td colspan="2" class="free-entry-label">自由入場，不需購票</td></tr>

                <tr class="venue-name"><td colspan="2">二、莫札特 Mozart 3/13 (五) 19:30 臺北國家演奏廳</td></tr>
                <tr><td>票價一 $500</td><td style="text-align:right"><select name="0313_台北_500" class="qty" data-price="500"></select></td></tr>
                <tr><td>票價二 $800</td><td style="text-align:right"><select name="0313_台北_800" class="qty" data-price="800"></select></td></tr>
                <tr><td>票價三 $1,000</td><td style="text-align:right"><select name="0313_台北_1000" class="qty" data-price="1000"></select></td></tr>

                <tr class="venue-name"><td colspan="2">三、貝多芬 Beethoven 3/15 (日) 15:00 北港基督長老教會</td></tr>
                <tr><td colspan="2" class="free-entry-label">自由入場，不需購票</td></tr>

                <tr class="venue-name"><td colspan="2">四、舒伯特 Schubert 3/22 (日) 19:30 臺北國家演奏廳</td></tr>
                <tr><td>票價一 $500</td><td style="text-align:right"><select name="0322_台北_500" class="qty" data-price="500"></select></td></tr>
                <tr><td>票價二 $800</td><td style="text-align:right"><select name="0322_台北_800" class="qty" data-price="800"></select></td></tr>
                <tr><td>票價三 $1,000</td><td style="text-align:right"><select name="0322_台北_1000" class="qty" data-price="1000"></select></td></tr>

                <tr class="venue-name"><td colspan="2">五、舒曼 Schumann 3/25 (三) 19:00 國立嘉義大學 文薈廳</td></tr>
                <tr><td colspan="2" class="free-entry-label">自由入場，不需購票</td></tr>

                <tr class="venue-name"><td colspan="2">六、蕭邦 Chopin 3/29 (日) 14:30 衛武營表演廳</td></tr>
                <tr><td>票價一 $400</td><td style="text-align:right"><select name="0329午_衛武營_400" class="qty" data-price="400"></select></td></tr>
                <tr><td>票價二 $600</td><td style="text-align:right"><select name="0329午_衛武營_600" class="qty" data-price="600"></select></td></tr>
                <tr><td>票價三 $1,000</td><td style="text-align:right"><select name="0329午_衛武營_1000" class="qty" data-price="1000"></select></td></tr>

                <tr class="venue-name"><td colspan="2">七、李斯特 Liszt 3/29 (日) 19:30 衛武營表演廳</td></tr>
                <tr><td>票價一 $400</td><td style="text-align:right"><select name="0329晚_衛武營_400" class="qty" data-price="400"></select></td></tr>
                <tr><td>票價二 $600</td><td style="text-align:right"><select name="0329晚_衛武營_600" class="qty" data-price="600"></select></td></tr>
                <tr><td>票價三 $1,000</td><td style="text-align:right"><select name="0329晚_衛武營_1000" class="qty" data-price="1000"></select></td></tr>

                <tr class="venue-name"><td colspan="2">八、布拉姆斯 Brahms 4/9 (四) 19:00 花蓮門諾醫院 薄柔纜禮拜堂</td></tr>
                <tr><td colspan="2" class="free-entry-label">自由入場，不需購票</td></tr>

                <tr class="venue-name"><td colspan="2">九、德布西 Debussy 4/11 (六) 15:00 宜蘭演藝廳</td></tr>
                <tr><td>票價 $300</td><td style="text-align:right"><select name="0411_宜蘭_300" class="qty" data-price="300"></select></td></tr>

                <tr class="venue-name"><td colspan="2">十、拉威爾 Ravel 4/12 (日) 14:30 臺中國家歌劇院小劇場</td></tr>
                <tr><td>票價 $600</td><td style="text-align:right"><select name="0412午_台中_600" class="qty" data-price="600"></select></td></tr>

                <tr class="venue-name"><td colspan="2">十一、拉赫瑪尼諾夫 Rachmaninoff 4/12 (日) 19:30 臺中國家歌劇院小劇場</td></tr>
                <tr><td>票價 $600</td><td style="text-align:right"><select name="0412晚_台中_600" class="qty" data-price="600"></select></td></tr>

                <tr class="venue-name">
                    <td colspan="2">
                        十二、蓋希文Gershwin 4/18 (六) 14:30 臺南成功大學 成杏廳
                        <span class="note-text">共同演出 / 廖培鈞<br>本場次為國立成功大學國際傷口修復與再生中心主辦之慈善音樂會</span>
                    </td>
                </tr>
                <tr><td>票價 $1,000</td><td style="text-align:right"><select name="0418_台南_1000" class="qty" data-price="1000"></select></td></tr>
            </tbody>
        </table>

        <h2>付款與取票</h2>
        <div class="form-group">
            <label>選擇付款方式</label>
            <input type="radio" name="付款方式" value="ATM轉帳" id="pay1" checked onclick="toggleBank(true)"> <label style="display:inline; font-weight:normal;" for="pay1">1. ATM 轉帳，現場取票</label><br>
            <input type="radio" name="付款方式" value="現場付款" id="pay2" onclick="toggleBank(false)"> <label style="display:inline; font-weight:normal;" for="pay2">2. 現場付款取票</label>
        </div>

        <div id="bankSection" class="bank-info">
            <strong>匯款資訊：</strong><br>
            銀行：oo銀行 oo分行 (代碼: xxx)<br>
            戶名：ooo<br>
            帳戶：oooo-oooo-oooo<br><br>
            <label>提供付款後五碼 (選擇轉帳者必填)</label>
            <input type="text" name="匯款後五碼" maxlength="5">
        </div>

        <div class="form-group" style="margin-top:20px;">
            <label>取票者姓名</label>
            <input type="text" name="取票者姓名">
        </div>

        <div class="form-group">
            <label>備註</label>
            <textarea name="備註" rows="3"></textarea>
        </div>

        <div class="summary-box">
            <div class="summary-line"><span>售票場次總票數：</span><span><span id="dispQty">0</span></span></div>
            <div class="summary-line"><span>原始總額：</span><span>$<span id="dispOrig">0</span></span></div>
            <div class="summary-line total-amount"><span>應付總額 (已計折扣)：</span><span>$<span id="dispFinal">0</span></span></div>
        </div>

        <input type="hidden" name="[統計] 總票數" id="hideQty">
        <input type="hidden" name="[統計] 應付總金額" id="hideFinal">

        <button type="submit" class="submit-btn" id="submitBtn">確認提交訂購單</button>
    </form>

    <div class="footer">
        主辦：斐亞文化藝術股份有限公司<br>
        聯絡電話：02-27711270<br>
        電子郵件：chorphilia@gmail.com
    </div>
</div>

<div class="container" id="success-message">
    <h3>您已成功登記 胡志龍的十二夜 票券</h3>
    <p>如有訂購相關問題可來信至 <a href="mailto:chorphilia@gmail.com">chorphilia@gmail.com</a></p>
    <button class="submit-btn" onclick="location.reload()">返回票券登記頁面</button>
</div>

<script>
    const qties = document.querySelectorAll('.qty');

    qties.forEach(select => {
        for (let i = 0; i <= 20; i++) {
            let opt = document.createElement('option');
            opt.value = i;
            opt.innerHTML = i;
            select.appendChild(opt);
        }
    });

    function calc() {
        let totalQty = 0;
        let originalPrice = 0;

        qties.forEach((q) => {
            let n = parseInt(q.value) || 0;
            let p = parseInt(q.getAttribute('data-price'));
            totalQty += n;
            originalPrice += (n * p);
        });

        let rate = 1;
        if (totalQty >= 5) rate = 0.7;
        else if (totalQty === 4) rate = 0.75;
        else if (totalQty === 3) rate = 0.8;

        let final = Math.round(originalPrice * rate);

        document.getElementById('dispQty').innerText = totalQty;
        document.getElementById('dispOrig').innerText = originalPrice.toLocaleString();
        document.getElementById('dispFinal').innerText = final.toLocaleString();
        
        document.getElementById('hideQty').value = totalQty;
        document.getElementById('hideFinal').value = "$" + final.toLocaleString();
    }

    function toggleBank(show) {
        document.getElementById('bankSection').style.display = show ? 'block' : 'none';
    }

    qties.forEach(el => el.addEventListener('change', calc));

    const form = document.getElementById('ticketForm');
    form.addEventListener('submit', function(e) {
        e.preventDefault();
        const btn = document.getElementById('submitBtn');
        btn.innerText = '處理中...';
        btn.disabled = true;

        fetch(form.action, {
            method: 'POST',
            body: new FormData(form),
            headers: { 'Accept': 'application/json' }
        }).then(response => {
            if (response.ok) {
                document.getElementById('form-container').style.display = 'none';
                document.getElementById('success-message').style.display = 'block';
                window.scrollTo(0, 0);
            } else {
                alert('發生錯誤，請稍後再試。');
                btn.innerText = '確認提交訂購單';
                btn.disabled = false;
            }
        });
    });
</script>

</body>
</html>
