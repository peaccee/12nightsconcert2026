<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èƒ¡å¿—é¾çš„åäºŒå¤œ - ç¥¨åˆ¸é è¨‚</title>
    <style>
        body { font-family: "Microsoft JhengHei", sans-serif; background-color: #f4f4f4; padding: 20px; color: #333; line-height: 1.6; }
        .container { max-width: 800px; margin: auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #2c3e50; font-size: 1.8em; margin-bottom: 10px; margin-top: 20px; }
        h2 { background: #f8f9fa; padding: 12px; border-left: 6px solid #b38b5d; font-size: 1.1em; margin-top: 30px; border-radius: 0 4px 4px 0; }
        
        .discount-tag { text-align: center; color: #d35400; font-weight: bold; background: #fff5eb; padding: 10px; border-radius: 8px; margin-bottom: 20px; border: 1px dashed #d35400; }
        
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input[type="text"], input[type="email"], input[type="tel"], select, textarea { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 6px; box-sizing: border-box; font-size: 16px; background-color: white; }
        
        table { width: 100%; border-collapse: collapse; margin: 15px 0; background: #fff; }
        td { padding: 12px; border-bottom: 1px solid #eee; }
        
        .venue-name { font-weight: bold; color: #b38b5d; background: #fdfdfd; border-top: 2px solid #eee; }
        .free-entry-label { color: #999; font-weight: normal; font-size: 0.95em; }
        .note-text { font-size: 0.85em; color: #7f8c8d; margin-top: 4px; display: block; line-height: 1.4; }

        .summary-box { background: #2c3e50; color: white; padding: 25px; border-radius: 10px; margin-top: 30px; }
        .summary-line { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 1.1em; }
        .total-amount { font-size: 1.6em; color: #f1c40f; border-top: 1px solid #5e6d7d; padding-top: 15px; margin-top: 10px; font-weight: bold; }
        
        .bank-info { background: #fdf9e7; padding: 20px; border-radius: 8px; border: 1px solid #e6dbac; margin-top: 15px; }
        .submit-btn { width: 100%; padding: 18px; background: #b38b5d; color: white; border: none; border-radius: 8px; font-size: 1.3em; cursor: pointer; margin-top: 25px; font-weight: bold; transition: 0.3s; }
        .submit-btn:hover { background: #96724a; }
        .secondary-btn { background: #bdc3c7; color: #333; margin-top: 10px; font-size: 1em; padding: 10px; }
        
        #confirm-container, #success-message { display: none; }
        .order-summary-list { text-align: left; background: #fff; padding: 20px; border: 2px solid #eee; border-radius: 8px; margin: 20px 0; }
        .order-item { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #f9f9f9; align-items: flex-start; }
        .order-venue-title { font-weight: bold; color: #2c3e50; margin-top: 15px; display: block; border-left: 3px solid #b38b5d; padding-left: 8px; }
        .order-sub-item { display: flex; justify-content: space-between; padding: 4px 0 4px 15px; font-size: 0.95em; color: #555; }

        .footer { text-align: center; margin-top: 40px; font-size: 0.9em; color: #7f8c8d; line-height: 1.8; border-top: 1px solid #eee; padding-top: 20px; }
    </style>
</head>
<body>

<div class="container" id="form-container">
    <h1>èƒ¡å¿—é¾ 2026 é‹¼ç´ç¨å¥æœƒ - èƒ¡å¿—é¾çš„åäºŒå¤œ</h1>
    
    <div class="discount-tag">
        è³¼ç¥¨å„ªæƒ ï¼š3å¼µ8æŠ˜ï½œ4å¼µ75æŠ˜ï½œ5å¼µä»¥ä¸Š7æŠ˜ (è·¨å ´æ¬¡ç´¯è¨ˆ)
    </div>

    <form id="ticketForm" action="https://formspree.io/f/xeeeoknw" method="POST">
        <h2>è³¼ç¥¨è€…è³‡è¨Š</h2>
        <div class="form-group"><label>è³¼ç¥¨è€…å§“å *</label><input type="text" name="è³¼ç¥¨è€…å§“å" id="form_name" required></div>
        <div class="form-group"><label>é›»å­ä¿¡ç®± Email *</label><input type="email" name="Email" id="form_email" required></div>
        <div class="form-group"><label>è¯çµ¡é›»è©± * (10ç¢¼æ•¸å­—)</label><input type="tel" name="è¯çµ¡é›»è©±" id="form_tel" required pattern="[0-9]{10}"></div>

        <h2>é¸æ“‡è¨‚è³¼å ´æ¬¡èˆ‡å¼µæ•¸</h2>
        <table>
            <tbody>
                <tr class="venue-name"><td colspan="2">ä¸€ã€å·´èµ« Bach 3/11 (ä¸‰) 19:00 è‡ºåŒ—å’Œå¹³åŸºç£é•·è€æ•™æœƒ</td></tr>
                <tr><td colspan="2" class="free-entry-label">è‡ªç”±å…¥å ´ï¼Œä¸éœ€è³¼ç¥¨</td></tr>

                <tr class="venue-name"><td colspan="2">äºŒã€è«æœ­ç‰¹ Mozart 3/13 (äº”) 19:30 è‡ºåŒ—åœ‹å®¶æ¼”å¥å»³</td></tr>
                <tr><td>ç¥¨åƒ¹ä¸€ $500</td><td style="text-align:right"><select name="0313_å°åŒ—_500" class="qty" data-price="500" data-label="ç¥¨åƒ¹ä¸€ $500"></select></td></tr>
                <tr><td>ç¥¨åƒ¹äºŒ $800</td><td style="text-align:right"><select name="0313_å°åŒ—_800" class="qty" data-price="800" data-label="ç¥¨åƒ¹äºŒ $800"></select></td></tr>
                <tr><td>ç¥¨åƒ¹ä¸‰ $1,000</td><td style="text-align:right"><select name="0313_å°åŒ—_1000" class="qty" data-price="1000" data-label="ç¥¨åƒ¹ä¸‰ $1,000"></select></td></tr>

                <tr class="venue-name"><td colspan="2">ä¸‰ã€è²å¤šèŠ¬ Beethoven 3/15 (æ—¥) 15:00 åŒ—æ¸¯åŸºç£é•·è€æ•™æœƒ</td></tr>
                <tr><td colspan="2" class="free-entry-label">è‡ªç”±å…¥å ´ï¼Œä¸éœ€è³¼ç¥¨</td></tr>

                <tr class="venue-name"><td colspan="2">å››ã€èˆ’ä¼¯ç‰¹ Schubert 3/22 (æ—¥) 19:30 è‡ºåŒ—åœ‹å®¶æ¼”å¥å»³</td></tr>
                <tr><td>ç¥¨åƒ¹ä¸€ $500</td><td style="text-align:right"><select name="0322_å°åŒ—_500" class="qty" data-price="500" data-label="ç¥¨åƒ¹ä¸€ $500"></select></td></tr>
                <tr><td>ç¥¨åƒ¹äºŒ $800</td><td style="text-align:right"><select name="0322_å°åŒ—_800" class="qty" data-price="800" data-label="ç¥¨åƒ¹äºŒ $800"></select></td></tr>
                <tr><td>ç¥¨åƒ¹ä¸‰ $1,000</td><td style="text-align:right"><select name="0322_å°åŒ—_1000" class="qty" data-price="1000" data-label="ç¥¨åƒ¹ä¸‰ $1,000"></select></td></tr>

                <tr class="venue-name"><td colspan="2">äº”ã€èˆ’æ›¼ Schumann 3/25 (ä¸‰) 19:00 åœ‹ç«‹å˜‰ç¾©å¤§å­¸ æ–‡è–ˆå»³</td></tr>
                <tr><td colspan="2" class="free-entry-label">è‡ªç”±å…¥å ´ï¼Œä¸éœ€è³¼ç¥¨</td></tr>

                <tr class="venue-name"><td colspan="2">å…­ã€è•­é‚¦ Chopin 3/29 (æ—¥) 14:30 è¡›æ­¦ç‡Ÿè¡¨æ¼”å»³</td></tr>
                <tr><td>ç¥¨åƒ¹ä¸€ $400</td><td style="text-align:right"><select name="0329åˆ_è¡›æ­¦ç‡Ÿ_400" class="qty" data-price="400" data-label="ç¥¨åƒ¹ä¸€ $400"></select></td></tr>
                <tr><td>ç¥¨åƒ¹äºŒ $600</td><td style="text-align:right"><select name="0329åˆ_è¡›æ­¦ç‡Ÿ_600" class="qty" data-price="600" data-label="ç¥¨åƒ¹äºŒ $600"></select></td></tr>
                <tr><td>ç¥¨åƒ¹ä¸‰ $1,000</td><td style="text-align:right"><select name="0329åˆ_è¡›æ­¦ç‡Ÿ_1000" class="qty" data-price="1000" data-label="ç¥¨åƒ¹ä¸‰ $1,000"></select></td></tr>

                <tr class="venue-name"><td colspan="2">ä¸ƒã€ææ–¯ç‰¹ Liszt 3/29 (æ—¥) 19:30 è¡›æ­¦ç‡Ÿè¡¨æ¼”å»³</td></tr>
                <tr><td>ç¥¨åƒ¹ä¸€ $400</td><td style="text-align:right"><select name="0329æ™š_è¡›æ­¦ç‡Ÿ_400" class="qty" data-price="400" data-label="ç¥¨åƒ¹ä¸€ $400"></select></td></tr>
                <tr><td>ç¥¨åƒ¹äºŒ $600</td><td style="text-align:right"><select name="0329æ™š_è¡›æ­¦ç‡Ÿ_600" class="qty" data-price="600" data-label="ç¥¨åƒ¹äºŒ $600"></select></td></tr>
                <tr><td>ç¥¨åƒ¹ä¸‰ $1,000</td><td style="text-align:right"><select name="0329æ™š_è¡›æ­¦ç‡Ÿ_1000" class="qty" data-price="1000" data-label="ç¥¨åƒ¹ä¸‰ $1,000"></select></td></tr>

                <tr class="venue-name"><td colspan="2">å…«ã€å¸ƒæ‹‰å§†æ–¯ Brahms 4/9 (å››) 19:00 èŠ±è“®é–€è«¾é†«é™¢ è–„æŸ”çºœç¦®æ‹œå ‚</td></tr>
                <tr><td colspan="2" class="free-entry-label">è‡ªç”±å…¥å ´ï¼Œä¸éœ€è³¼ç¥¨</td></tr>

                <tr class="venue-name"><td colspan="2">ä¹ã€å¾·å¸ƒè¥¿ Debussy 4/11 (å…­) 15:00 å®œè˜­æ¼”è—å»³</td></tr>
                <tr><td>ç¥¨åƒ¹ $300</td><td style="text-align:right"><select name="0411_å®œè˜­_300" class="qty" data-price="300" data-label="ç¥¨åƒ¹ $300"></select></td></tr>

                <tr class="venue-name"><td colspan="2">åã€æ‹‰å¨çˆ¾ Ravel 4/12 (æ—¥) 14:30 è‡ºä¸­åœ‹å®¶æ­ŒåŠ‡é™¢å°åŠ‡å ´</td></tr>
                <tr><td>ç¥¨åƒ¹ $600</td><td style="text-align:right"><select name="0412åˆ_å°ä¸­_600" class="qty" data-price="600" data-label="ç¥¨åƒ¹ $600"></select></td></tr>

                <tr class="venue-name"><td colspan="2">åä¸€ã€æ‹‰èµ«ç‘ªå°¼è«¾å¤« Rachmaninoff 4/12 (æ—¥) 19:30 è‡ºä¸­åœ‹å®¶æ­ŒåŠ‡é™¢å°åŠ‡å ´</td></tr>
                <tr><td>ç¥¨åƒ¹ $600</td><td style="text-align:right"><select name="0412æ™š_å°ä¸­_600" class="qty" data-price="600" data-label="ç¥¨åƒ¹ $600"></select></td></tr>

                <tr class="venue-name">
                    <td colspan="2">
                        åäºŒã€è“‹å¸Œæ–‡Gershwin 4/18 (å…­) 14:30 è‡ºå—æˆåŠŸå¤§å­¸ æˆæå»³
                        <span class="note-text">å…±åŒæ¼”å‡º / å»–åŸ¹éˆ<br>æœ¬å ´æ¬¡ç‚ºåœ‹ç«‹æˆåŠŸå¤§å­¸åœ‹éš›å‚·å£ä¿®å¾©èˆ‡å†ç”Ÿä¸­å¿ƒä¸»è¾¦ä¹‹æ…ˆå–„éŸ³æ¨‚æœƒ</span>
                    </td>
                </tr>
                <tr><td>ç¥¨åƒ¹ $1,000</td><td style="text-align:right"><select name="0418_å°å—_1000" class="qty" data-price="1000" data-label="ç¥¨åƒ¹ $1,000"></select></td></tr>
            </tbody>
        </table>

        <h2>ä»˜æ¬¾èˆ‡å–ç¥¨</h2>
        <div class="form-group">
            <label>é¸æ“‡ä»˜æ¬¾æ–¹å¼</label>
            <input type="radio" name="ä»˜æ¬¾æ–¹å¼" value="ATMè½‰å¸³" id="pay1" checked onclick="toggleBank(true)"> <label style="display:inline; font-weight:normal;" for="pay1">1. ATM è½‰å¸³ï¼Œç¾å ´å–ç¥¨</label><br>
            <input type="radio" name="ä»˜æ¬¾æ–¹å¼" value="ç¾å ´ä»˜æ¬¾" id="pay2" onclick="toggleBank(false)"> <label style="display:inline; font-weight:normal;" for="pay2">2. ç¾å ´ä»˜æ¬¾å–ç¥¨</label>
        </div>

        <div id="bankSection" class="bank-info">
            <strong>åŒ¯æ¬¾è³‡è¨Šï¼š</strong><br>éŠ€è¡Œï¼šooéŠ€è¡Œ (ä»£ç¢¼: xxx) / å¸³æˆ¶ï¼šoooo-oooo-oooo<br><br>
            <label>æä¾›ä»˜æ¬¾å¾Œäº”ç¢¼ (é¸æ“‡è½‰å¸³è€…å¿…å¡«)</label>
            <input type="text" name="åŒ¯æ¬¾å¾Œäº”ç¢¼" id="form_bank_id" maxlength="5">
        </div>

        <div class="form-group" style="margin-top:20px;"><label>å–ç¥¨è€…å§“å</label><input type="text" name="å–ç¥¨è€…å§“å" id="form_pickup"></div>
        <div class="form-group"><label>å‚™è¨»</label><textarea name="å‚™è¨»" id="form_memo" rows="3"></textarea></div>

        <div class="summary-box">
            <div class="summary-line"><span>å”®ç¥¨å ´æ¬¡ç¸½ç¥¨æ•¸ï¼š</span><span><span id="dispQty">0</span></span></div>
            <div class="summary-line"><span>åŸå§‹ç¸½é¡ï¼š</span><span>$<span id="dispOrig">0</span></span></div>
            <div class="summary-line total-amount"><span>æ‡‰ä»˜ç¸½é¡ (å·²è¨ˆæŠ˜æ‰£)ï¼š</span><span>$<span id="dispFinal">0</span></span></div>
        </div>
        <input type="hidden" name="[çµ±è¨ˆ] ç¸½ç¥¨æ•¸" id="hideQty">
        <input type="hidden" name="[çµ±è¨ˆ] æ‡‰ä»˜ç¸½é‡‘é¡" id="hideFinal">
        <button type="button" class="submit-btn" onclick="showConfirm()">é€²å…¥è¨‚å–®ç¢ºèªé é¢</button>
    </form>
</div>

<div class="container" id="confirm-container">
    <h2 style="text-align:center; border:none; background:none; font-size:1.5em; color:#d35400;">è«‹æœ€å¾Œç¢ºèªæ‚¨çš„è¨‚è³¼è³‡è¨Š</h2>
    <div class="order-summary-list" id="confirm-details"></div>
    <button type="button" class="submit-btn" id="finalSubmitBtn" onclick="finalSubmit()">ç¢ºèªç„¡èª¤ï¼Œæ­£å¼é€å‡º</button>
    <button type="button" class="submit-btn secondary-btn" onclick="backToEdit()">å›ä¸Šä¸€æ­¥ä¿®æ”¹</button>
</div>

<div class="container" id="success-message" style="text-align: center;">
    <h3 style="color: #2c3e50; font-size: 1.5em; margin-bottom: 20px;">ğŸ‰ æ‚¨å·²æˆåŠŸç™»è¨˜ èƒ¡å¿—é¾çš„åäºŒå¤œ ç¥¨åˆ¸</h3>
    <div class="order-summary-list" id="success-details" style="background:#fdfdfd;"></div>
    <p style="color: #d35400; font-weight: bold; margin-bottom: 20px;">ğŸ“¸ å»ºè­°æ‚¨æˆªåœ–æ­¤é é¢ï¼Œä½œç‚ºå–ç¥¨æ†‘è­‰ç•™å­˜ã€‚</p>
    <p style="color: #666; font-size: 0.9em; margin-bottom: 30px;">å¦‚æœ‰è¨‚è³¼å•é¡Œå¯ä¾†ä¿¡è‡³ <a href="mailto:chorphilia@gmail.com">chorphilia@gmail.com</a></p>
    <button class="submit-btn" onclick="location.reload()">è¿”å›ç¥¨åˆ¸ç™»è¨˜é é¢</button>
</div>

<div class="footer">ä¸»è¾¦ï¼šæ–äºæ–‡åŒ–è—è¡“è‚¡ä»½æœ‰é™å…¬å¸ | 02-27711270</div>

<script>
    const qties = document.querySelectorAll('.qty');
    qties.forEach(select => {
        for (let i = 0; i <= 20; i++) {
            let opt = document.createElement('option'); opt.value = i; opt.innerHTML = i; select.appendChild(opt);
        }
    });

    function calc() {
        let totalQty = 0, originalPrice = 0;
        qties.forEach((q) => {
            let n = parseInt(q.value) || 0, p = parseInt(q.getAttribute('data-price'));
            totalQty += n; originalPrice += (n * p);
        });
        let rate = 1;
        if (totalQty >= 5) rate = 0.7; else if (totalQty === 4) rate = 0.75; else if (totalQty === 3) rate = 0.8;
        let final = Math.round(originalPrice * rate);
        document.getElementById('dispQty').innerText = totalQty;
        document.getElementById('dispOrig').innerText = originalPrice.toLocaleString();
        document.getElementById('dispFinal').innerText = final.toLocaleString();
        document.getElementById('hideQty').value = totalQty;
        document.getElementById('hideFinal').value = "$" + final.toLocaleString();
    }
    qties.forEach(el => el.addEventListener('change', calc));

    function toggleBank(show) { document.getElementById('bankSection').style.display = show ? 'block' : 'none'; }

    function generateOrderHtml() {
        let name = document.getElementById('form_name').value, tel = document.getElementById('form_tel').value;
        let payMethod = document.querySelector('input[name="ä»˜æ¬¾æ–¹å¼"]:checked').value;
        let finalAmt = document.getElementById('dispFinal').innerText, bankId = document.getElementById('form_bank_id').value;
        let pickupName = document.getElementById('form_pickup').value || name;

        let html = `<div class="order-item"><span>è¨‚è³¼å§“å</span><span>${name}</span></div>`;
        html += `<div class="order-item"><span>è¯çµ¡é›»è©±</span><span>${tel}</span></div>`;
        html += `<div class="order-item"><span>ä»˜æ¬¾æ–¹å¼</span><span>${payMethod}</span></div>`;
        if(payMethod === "ATMè½‰å¸³") html += `<div class="order-item"><span>åŒ¯æ¬¾å¾Œäº”ç¢¼</span><span>${bankId}</span></div>`;
        html += `<div class="order-item"><span>å–ç¥¨å§“å</span><span>${pickupName}</span></div>`;
        
        html += `<div style="margin-top:20px; border-top:2px solid #b38b5d; padding-top:10px;"><strong>è¨‚è³¼æ˜ç´°ï¼š</strong></div>`;
        
        let lastVenue = "";
        qties.forEach((q) => {
            let n = parseInt(q.value) || 0;
            if(n > 0) {
                // å°‹æ‰¾è©² select æ‰€å±¬çš„å ´æ¬¡æ¨™é¡Œ
                let currentVenue = q.closest('tr').previousElementSibling;
                while (currentVenue && !currentVenue.classList.contains('venue-name')) {
                    currentVenue = currentVenue.previousElementSibling;
                }
                let venueTitle = currentVenue ? currentVenue.innerText.split('\n')[0] : "éŸ³æ¨‚æœƒå ´æ¬¡";
                
                if(venueTitle !== lastVenue) {
                    html += `<span class="order-venue-title">${venueTitle}</span>`;
                    lastVenue = venueTitle;
                }
                html += `<div class="order-sub-item"><span>${q.getAttribute('data-label')}</span><span>${n} å¼µ</span></div>`;
            }
        });
        html += `<div class="order-item" style="font-weight:bold; color:#d35400; font-size:1.3em; margin-top:15px; border-top:1px solid #ddd;"><span>æ‡‰ä»˜ç¸½é¡</span><span>$${finalAmt}</span></div>`;
        return html;
    }

    function showConfirm() {
        if(!document.getElementById('form_name').value || !document.getElementById('form_tel').value) { alert("è«‹å¡«å¯«å§“åèˆ‡é›»è©±ï¼"); return; }
        if(parseInt(document.getElementById('dispQty').innerText) === 0) { alert("è«‹é¸æ“‡å ´æ¬¡ï¼"); return; }
        document.getElementById('confirm-details').innerHTML = generateOrderHtml();
        document.getElementById('form-container').style.display = 'none';
        document.getElementById('confirm-container').style.display = 'block';
        window.scrollTo(0, 0);
    }

    function backToEdit() {
        document.getElementById('form-container').style.display = 'block';
        document.getElementById('confirm-container').style.display = 'none';
    }

    function finalSubmit() {
        const form = document.getElementById('ticketForm'), btn = document.getElementById('finalSubmitBtn');
        btn.innerText = 'è™•ç†ä¸­...'; btn.disabled = true;
        fetch(form.action, { method: 'POST', body: new FormData(form), headers: { 'Accept': 'application/json' }
        }).then(response => {
            if (response.ok) {
                document.getElementById('success-details').innerHTML = generateOrderHtml();
                document.getElementById('confirm-container').style.display = 'none';
                document.getElementById('success-message').style.display = 'block';
                window.scrollTo(0, 0);
            } else { alert('æäº¤å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯ã€‚'); btn.innerText = 'ç¢ºèªä¸¦é€å‡º'; btn.disabled = false; }
        });
    }
</script>
</body>
</html>
